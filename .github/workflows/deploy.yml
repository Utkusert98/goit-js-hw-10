name: Build and deploy to Main Branch Root

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2.3.1
        with:
          # TÃ¼m geÃ§miÅŸi getir, bu daha sonra force push iÃ§in gerekebilir
          fetch-depth: 0

      - name: Setup Node.js ğŸš€ # Node.js'in belirli bir sÃ¼rÃ¼mÃ¼nÃ¼ kurar
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Vite projeniz iÃ§in uygun Node.js sÃ¼rÃ¼mÃ¼nÃ¼ buraya yazÄ±n (Ã¶rneÄŸin '18', '20')

      - name: Install and build ğŸ”§
        run: |
          npm install
          # Vite yÃ¼rÃ¼tÃ¼lebilir dosyasÄ±na Ã§alÄ±ÅŸtÄ±rma izni ver (Ã¶nceki hatayÄ± Ã¶nlemek iÃ§in)
          chmod +x node_modules/.bin/vite || true
          npm run build

      - name: Deploy to Main Branch Root ğŸš€
        run: |
          # Git kullanÄ±cÄ± bilgilerini yapÄ±landÄ±r
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # GeÃ§ici bir dizin oluÅŸtur ve derlenmiÅŸ dosyalarÄ± buraya kopyala
          mkdir deploy_temp
          cp -r dist/* deploy_temp/

          # GeÃ§ici dizine git
          cd deploy_temp

          # Yeni bir Git deposu baÅŸlat
          git init

          # TÃ¼m dosyalarÄ± ekle ve commit et
          git add .
          git commit -m "Deploy built files to main branch"

          # Uzak depoyu (kendi deponuzu) ekle
          # GITHUB_TOKEN, GitHub Actions tarafÄ±ndan otomatik olarak saÄŸlanan bir belirteÃ§tir
          git remote add origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

          # main dalÄ±na zorla push et
          # DÄ°KKAT: Bu komut, main dalÄ±nÄ±n mevcut iÃ§eriÄŸini deploy_temp'in iÃ§eriÄŸiyle tamamen deÄŸiÅŸtirecektir.
          git push --force origin main
